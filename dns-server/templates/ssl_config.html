{% extends "base.html" %}

{% block content %}
<div class="container ssl-config-container">
  <div class="topbar">
    <h2>ğŸ”’ ConfiguraÃ§Ã£o SSL</h2>
    <div class="user-menu">
      <div class="user-icon" onclick="toggleMenu()">ğŸ‘¤</div>
      <div class="menu-dropdown" id="menuDropdown">
        {% if session.get('is_admin') %}
          <a href="/admin" class="menu-item">âš™ï¸ ConfiguraÃ§Ãµes</a>
        {% endif %}
        <form method="POST" action="/logout" style="margin:0;">
          <button type="submit" class="menu-item">ğŸšª Logout</button>
        </form>
      </div>
    </div>
  </div>

  <!-- InformaÃ§Ãµes do DomÃ­nio -->
  <div class="card domain-info">
    <h3>ConfiguraÃ§Ã£o SSL para</h3>
    <p><strong>DomÃ­nio:</strong> <code>{{ domain }}</code></p>
    <p><strong>IP:</strong> <code>{{ ip }}</code></p>
  </div>

  <div class="card">
    <form method="post">
      <!-- Checkbox SSL -->
      <div class="checkbox-container">
        <label class="checkbox-label">
          <input type="checkbox" name="ssl_enabled" {{ 'checked' if ssl_info.ssl_enabled }}>
          <span class="checkbox-custom"></span>
          <span class="checkbox-text">
            <span class="checkbox-title">Habilitar SSL/HTTPS</span>
            <span class="checkbox-description">
              Quando habilitado, o sistema configurarÃ¡ automaticamente o Nginx para servir este domÃ­nio via HTTPS
            </span>
          </span>
        </label>
      </div>

      <!-- ConfiguraÃ§Ã£o de Portas -->
      <div class="ports-config">
        <div class="ports-header">
          <h4>ğŸŒ ConfiguraÃ§Ã£o de Portas</h4>
        </div>
        <div class="ports-grid">
          <div class="port-input-group">
            <label for="http_port">Porta HTTP</label>
            <div class="port-input-wrapper">
              <input type="number" id="http_port" name="http_port" 
                     value="{{ ssl_info.http_port }}" min="1" max="65535" 
                     placeholder="80">
            </div>
            <small class="text-muted">Porta do serviÃ§o HTTP interno</small>
          </div>
          
          <div class="port-input-group">
            <label for="ssl_port">Porta HTTPS</label>
            <div class="port-input-wrapper https">
              <input type="number" id="ssl_port" name="ssl_port" 
                     value="{{ ssl_info.ssl_port }}" min="1" max="65535" 
                     placeholder="443">
            </div>
            <small class="text-muted">Porta do serviÃ§o HTTPS interno</small>
          </div>
        </div>
      </div>

      <!-- AÃ§Ãµes -->
      <div class="form-actions">
        <button type="submit" class="btn-primary">
          ğŸ’¾ Salvar ConfiguraÃ§Ãµes
        </button>
        <a href="/" class="btn-secondary">â† Voltar ao Painel</a>
      </div>
    </form>
  </div>

  <!-- InformaÃ§Ãµes -->
  <div class="card ssl-info-card">
    <h4>ğŸ“‹ Como funciona o SSL</h4>
    <ul class="info-list">
      <li>
        <strong>ğŸ”’ SSL Habilitado:</strong> 
        O Nginx redireciona automaticamente HTTP â†’ HTTPS e serve via SSL
      </li>
      <li>
        <strong>ğŸ”“ SSL Desabilitado:</strong> 
        O domÃ­nio serÃ¡ servido apenas via HTTP
      </li>
      <li>
        <strong>ğŸŒ Portas:</strong> 
        Configure as portas especÃ­ficas usadas pelo seu serviÃ§o backend
      </li>
      <li>
        <strong>âš¡ AutomÃ¡tico:</strong> 
        As configuraÃ§Ãµes do Nginx sÃ£o atualizadas automaticamente
      </li>
    </ul>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function toggleMenu() {
  const menu = document.getElementById('menuDropdown');
  if (menu) {
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
  }
}

// Fechar menu ao clicar fora
document.addEventListener('click', (e) => {
  const menu = document.getElementById('menuDropdown');
  const icon = document.querySelector('.user-icon');
  
  if (menu && icon && !icon.contains(e.target) && !menu.contains(e.target)) {
    menu.style.display = 'none';
  }
});

// Feedback visual para o checkbox
document.addEventListener('DOMContentLoaded', function() {
  const checkbox = document.querySelector('input[name="ssl_enabled"]');
  const portsConfig = document.querySelector('.ports-config');
  
  function togglePortsVisibility() {
    if (checkbox.checked) {
      portsConfig.style.opacity = '1';
      portsConfig.style.pointerEvents = 'all';
    } else {
      portsConfig.style.opacity = '0.6';
      portsConfig.style.pointerEvents = 'none';
    }
  }
  
  // Aplicar estado inicial
  togglePortsVisibility();
  
  // Adicionar listener
  checkbox.addEventListener('change', togglePortsVisibility);
});
</script>
{% endblock %}